<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <title>éŠæˆ²æ›´æ–°æ—¥æ›†</title>
    <button id="updateBtn" class="update-btn">ğŸ”„ æ›´æ–°è³‡æ–™</button>
    <link
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  </head>
  <body>
    <h2>äºŒéŠäº‹ä»¶æ›´æ–°æ—¥æ›†</h2>
    <div id="calendar"></div>

    <script>
      const gameColors = {
        åŸç¥: "#4CAF50",
        éµé“: "#3F51B5",
        é³´æ½®: "#E91E63",
      };

      // åˆå§‹åŒ–æ—¥æ›†
      const calendarEl = document.getElementById("calendar");
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        locale: "zh-tw",
        events: [], // å…ˆç©º
      });
      calendar.render();

      // æŒ‰éˆ•æ›´æ–°
      document
        .getElementById("updateBtn")
        .addEventListener("click", async () => {
          const btn = document.getElementById("updateBtn");
          btn.disabled = true;
          btn.textContent = "æ›´æ–°ä¸­...";

          try {
            const res = await fetch("/api/update", { method: "POST" });
            if (!res.ok) throw new Error("æ›´æ–°å¤±æ•—");

            const events = await res.json();

            // æ¸…ç©ºèˆŠäº‹ä»¶
            calendar.removeAllEvents();

            // æ–°å¢äº‹ä»¶
            events.forEach((e) => {
              calendar.addEvent({
                title: `${e.game} ${e.title}`,
                start: e.dates,
                color: gameColors[e.game] || "#2196F3",
              });
            });

            alert("âœ… æ›´æ–°å®Œæˆ");
          } catch (e) {
            console.error(e);
            alert("âŒ æ›´æ–°å¤±æ•—");
          } finally {
            btn.disabled = false;
            btn.textContent = "ğŸ”„ æ›´æ–°è³‡æ–™";
          }
        });
    </script>
    <style>
      body {
        font-family: system-ui;
        margin: 5px;
      }

      #calendar {
        max-width: 1000px; /* â† é—œéµ */
        margin: 0 auto; /* ç½®ä¸­ */
      }
      .fc-event-title {
        font-size: 0.75rem;
        white-space: normal; /* å…è¨±æ›è¡Œ */
      }
      .update-btn {
        position: fixed;
        top: 16px;
        right: 16px;
        padding: 8px 14px;
        font-size: 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: #222;
        color: white;
      }

      .update-btn:hover {
        background: #444;
      }
    </style>
  </body>
</html>
