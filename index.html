<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <title>éŠæˆ²æ›´æ–°æ—¥æ›†</title>
    <button id="updateBtn" class="update-btn">ğŸ”„ æ›´æ–°è³‡æ–™</button>
    <link
      href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  </head>
  <body>
    <h2>äºŒéŠäº‹ä»¶æ›´æ–°æ—¥æ›†</h2>
    <div id="calendar"></div>

    <script>
      const gameColors = {
        åŸç¥: "#4CAF50", // ç¶ 
        éµé“: "#3F51B5", // è—ç´«
        é³´æ½®: "#E91E63", // ç²‰ç´…
      };

      // å…ˆè¼‰å…¥æ—¥æ›†
      fetch("./events.json")
        .then((res) => res.json())
        .then((events) => {
          const calendar = new FullCalendar.Calendar(
            document.getElementById("calendar"),
            {
              initialView: "dayGridMonth",
              locale: "zh-tw",
              events: events.map((e) => ({
                title: `${e.game} ${e.title}`,
                start: e.dates,
                color: gameColors[e.game] || "#2196F3",
              })),
            },
          );
          calendar.render();
        });

      // æŒ‰éˆ•æ›´æ–°
      document
        .getElementById("updateBtn")
        .addEventListener("click", async () => {
          const btn = document.getElementById("updateBtn");
          btn.disabled = true;
          btn.textContent = "æ›´æ–°ä¸­...";

          try {
            // æŒ‡å‘ Vercel API
            const res = await fetch(
              "https://hoyo-calendar.vercel.app/api/update",
              { method: "POST" },
            );

            if (!res.ok) throw new Error("æ›´æ–°å¤±æ•—");

            alert("âœ… æ›´æ–°å®Œæˆ");
            location.reload(); // é‡æ–°è®€ events.json
          } catch (e) {
            alert("âŒ æ›´æ–°å¤±æ•—ï¼Œè«‹çœ‹çµ‚ç«¯æ©Ÿ");
            console.error(e);
          } finally {
            btn.disabled = false;
            btn.textContent = "ğŸ”„ æ›´æ–°è³‡æ–™";
          }
        });
    </script>
    <style>
      body {
        font-family: system-ui;
        margin: 5px;
      }

      #calendar {
        max-width: 1000px; /* â† é—œéµ */
        margin: 0 auto; /* ç½®ä¸­ */
      }
      .fc-event-title {
        font-size: 0.75rem;
        white-space: normal; /* å…è¨±æ›è¡Œ */
      }
      .update-btn {
        position: fixed;
        top: 16px;
        right: 16px;
        padding: 8px 14px;
        font-size: 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background: #222;
        color: white;
      }

      .update-btn:hover {
        background: #444;
      }
    </style>
  </body>
</html>
